#include "dsplib/window.h"
#include "tests_common.h"

using namespace dsplib;

TEST(Window, Gauss) {
    arr_real x1 = window::gauss(16, 2.5);
    arr_real x2 = {0.0439, 0.0956, 0.1863, 0.3247, 0.5063, 0.7066, 0.8825, 0.9862,
                   0.9862, 0.8825, 0.7066, 0.5063, 0.3247, 0.1863, 0.0956, 0.0439};
    ASSERT_EQ_ARR_REAL(x1, x2, 1e-3);
}

TEST(Window, Blackmanharris) {
    {
        arr_real x1 = window::blackmanharris(16);
        arr_real x2 = {0.0001, 0.0036, 0.0267, 0.1030, 0.2680, 0.5206, 0.7938, 0.9749,
                       0.9749, 0.7938, 0.5206, 0.2680, 0.1030, 0.0267, 0.0036, 0.0001};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-4);
    }

    {
        arr_real x1 = window::blackmanharris(15, false);
        arr_real x2 = {0.0001, 0.0036, 0.0267, 0.1030, 0.2680, 0.5206, 0.7938, 0.9749,
                       0.9749, 0.7938, 0.5206, 0.2680, 0.1030, 0.0267, 0.0036};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-4);
    }

    {
        arr_real x1 = window::blackmanharris(15);
        arr_real x2 = {6.00000000000010e-05, 0.00430350618991988, 0.0333917234781512,  0.130088732386928,
                       0.332833504298565,    0.621232761423153,   0.889369772223284,   1,
                       0.889369772223284,    0.621232761423153,   0.332833504298565,   0.130088732386928,
                       0.0333917234781512,   0.00430350618991990, 6.00000000000010e-05};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-4);
    }
}

TEST(Window, Kaiser) {
    {
        arr_real x1 = window::kaiser(32, 1);
        arr_real x2 = {0.789848314825112, 0.814698491938938, 0.838242773832630, 0.860411532965690, 0.881139078670412,
                       0.900363879028368, 0.918028768889845, 0.934081143290337, 0.948473135570260, 0.961161779558600,
                       0.972109155238211, 0.981282517369581, 0.988654406610948, 0.994202742735461, 0.997910899610286,
                       0.999767761668133, 0.999767761668133, 0.997910899610286, 0.994202742735461, 0.988654406610948,
                       0.981282517369581, 0.972109155238211, 0.961161779558600, 0.948473135570260, 0.934081143290337,
                       0.918028768889845, 0.900363879028368, 0.881139078670412, 0.860411532965690, 0.838242773832630,
                       0.814698491938938, 0.789848314825112};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
    }
    {
        arr_real x1 = window::kaiser(17, 10);
        arr_real x2 = {0.000355149374724085, 0.00839739195551166, 0.0419398003277483,
                       0.126702801536292,    0.282059620822732,   0.501196800507225,
                       0.740117133443384,    0.928314456667877,   1,
                       0.928314456667877,    0.740117133443384,   0.501196800507225,
                       0.282059620822732,    0.126702801536292,   0.0419398003277483,
                       0.00839739195551166,  0.000355149374724085};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
    }
}

TEST(Window, Tukey) {
    {
        arr_real x1 = window::tukey(16, 0.7);
        arr_real x2 = {
          0, 0.0868806128420027, 0.317329487816803, 0.611260466978157, 0.866525935914913, 0.994415413112564,  1, 1, 1,
          1, 0.994415413112564,  0.866525935914913, 0.611260466978157, 0.317329487816803, 0.0868806128420027, 0};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
    }
    {
        arr_real x1 = window::tukey(17, 0.7);
        arr_real x2 = {0,
                       0.0766379003858579,
                       0.283058130441221,
                       0.555982238051654,
                       0.811744900929367,
                       0.971941665154184,
                       1,
                       1,
                       1,
                       1,
                       1,
                       0.971941665154184,
                       0.811744900929367,
                       0.555982238051654,
                       0.283058130441221,
                       0.0766379003858579,
                       0};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
    }
    {
        arr_real x1 = window::tukey(16, 0);
        arr_real x2 = {1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
    }
    {
        arr_real x1 = window::tukey(16, 1);
        arr_real x2 = window::hann(16);
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
    }
}

TEST(Window, Hann) {
    arr_real x1 = window::hann(16);
    arr_real x2 = {0,
                   0.0432272711786996,
                   0.165434696820571,
                   0.345491502812526,
                   0.552264231633827,
                   0.750000000000000,
                   0.904508497187474,
                   0.989073800366903,
                   0.989073800366903,
                   0.904508497187474,
                   0.750000000000000,
                   0.552264231633827,
                   0.345491502812526,
                   0.165434696820571,
                   0.0432272711786996,
                   0};
    ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
}

TEST(Window, Hamming) {
    arr_real x1 = window::hamming(16);
    arr_real x2 = {0.0800000000000000, 0.119769089484404, 0.232199921074925, 0.397852182587524,
                   0.588083093103121,  0.770000000000000, 0.912147817412476, 0.989947896337551,
                   0.989947896337551,  0.912147817412476, 0.770000000000000, 0.588083093103121,
                   0.397852182587524,  0.232199921074925, 0.119769089484404, 0.0800000000000000};
    ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
}

TEST(Window, Blackman) {
    arr_real x1 = window::blackman(16);
    arr_real x2 = {0,
                   0.0167577196874082,
                   0.0770724197591586,
                   0.200770143262530,
                   0.394012423575122,
                   0.630000000000000,
                   0.849229856737469,
                   0.982157436978311,
                   0.982157436978311,
                   0.849229856737469,
                   0.630000000000000,
                   0.394012423575122,
                   0.200770143262530,
                   0.0770724197591586,
                   0.0167577196874082,
                   0};
    ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
}

TEST(Window, Cosine) {
    {
        arr_real x1 = window::cosine(16);
        arr_real x2 = {0.09801714, 0.29028468, 0.47139674, 0.63439328, 0.77301045, 0.88192126, 0.95694034, 0.99518473,
                       0.99518473, 0.95694034, 0.88192126, 0.77301045, 0.63439328, 0.47139674, 0.29028468, 0.09801714};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
    }
    {
        arr_real x1 = window::cosine(10);
        arr_real x2 = {0.15643447, 0.4539905,  0.70710678, 0.89100652, 0.98768834,
                       0.98768834, 0.89100652, 0.70710678, 0.4539905,  0.15643447};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
    }
    {
        arr_real x1 = window::cosine(10, false);
        arr_real x2 = {0.14231484, 0.41541501, 0.65486073, 0.84125353, 0.95949297,
                       1.,         0.95949297, 0.84125353, 0.65486073, 0.41541501};
        ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
    }
}

TEST(Window, Vorbis) {
    arr_real x1 = window::vorbis(64).slice(0, 32);
    arr_real x2 = {
      0.0009460463F, 0.0085006468F, 0.0235352254F, 0.0458950567F, 0.0753351908F, 0.1115073077F, 0.1539457973F,
      0.2020557475F, 0.2551056759F, 0.3122276645F, 0.3724270287F, 0.4346027792F, 0.4975789974F, 0.5601459521F,
      0.6211085051F, 0.6793382689F, 0.7338252629F, 0.7837245849F, 0.8283939355F, 0.8674186656F, 0.9006222429F,
      0.9280614787F, 0.9500073081F, 0.9669131782F, 0.9793740220F, 0.9880792941F, 0.9937636139F, 0.9971582668F,
      0.9989462667F, 0.9997230082F, 0.9999638688F, 0.9999995525F,
    };
    ASSERT_EQ_ARR_REAL(x1, x2, 1e-7);
}